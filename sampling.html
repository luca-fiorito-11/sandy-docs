
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sampling &#8212; SANDY 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="sampling">
<h1>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> can work as a nuclear data sampling tool applicable to sensitivity
analysis (SA) and uncertainty quantification (UQ) problems.
The code exploits the basic theory of Monte Carlo sampling to
propagate nuclear data covariances through the nuclear models under study.</p>
<div class="section" id="definition-of-best-estimates-and-covariances">
<h2>Definition of best-estimates and covariances<a class="headerlink" href="#definition-of-best-estimates-and-covariances" title="Permalink to this headline">¶</a></h2>
<p>Nuclear parameters <span class="math">\mathbf{x}=\left[x_1, x_2, \dots, x_m\right]^T</span> — e.g.
cross sections, resonances, decay constants, particle energy-angular
distributions, … —
are stored in the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> nuclear data libraries as best-estimate or
evaluated data</p>
<div class="math">
<p><span class="math">x_{i,BE} = E \left[ x_i \right] = \int x_i p(\mathbf{x}) d\mathbf{x}\,,</span></p>
</div><p>where <span class="math">E</span> is the expectation operator which performs the integral of
the selected <em>i-th</em> parameter <span class="math">x_i</span> over the joint probability
distribution of <span class="math">x</span>, <span class="math">p(\mathbf{x})</span>.
Best-estimate parameters are often used as inputs of numerical models.</p>
<p>UQ studies aim at propagating the model input uncertainties and/or covariances
to the model responses.
Along this working line, the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format allowed storing the covariance
matrices <span class="math">\mathbf{\Sigma}</span> of the best-estimate nuclear data provided.</p>
<p>A covariance matrix <span class="math">\mathbf{\Sigma}</span> of the best-estimate data <span class="math">\mathbf{x}_{BE}</span>
contains the so-called variance terms on the diagonal</p>
<div class="math">
<p><span class="math">\Sigma_{i,i} \equiv cov(x_i, x_i) \equiv V(x_i) = E \left[ (x_i - x_{i,BE})^2 \right]\,.</span></p>
</div><p>From the variance term of a parameter <span class="math">x_i</span>, one can extract its
standard deviation (or uncertainty)</p>
<div class="math">
<p><span class="math">\Delta x_i \equiv \sqrt{V(x_i)} = cov(x_i, x_i)^{1/2}\,.</span></p>
</div><p>The off-diagonal terms contain the covariances, a generalization of the
variance integral to two different variables</p>
<div class="math">
<p><span class="math">\Sigma_{i,j} \equiv cov(x_i, x_j) = E \left[ (x_i - x_{i,BE})(x_j - x_{j,BE}) \right]\,.</span></p>
</div><p>The covariance is a measure of the joint variability of two variables to the
same source of error.</p>
<p>A covariance <span class="math">\Sigma_{i,j}</span> can be expressed in terms of the standard
deviations of its parameters introducing the Pearson correlation coefficient
<span class="math">\rho_{i,j}</span>:</p>
<div class="math">
<p><span class="math">cov(x_i, x_j) = \rho_{i,j} \Delta x_i \Delta x_j\,.</span></p>
</div><p>The Pearson correlation coefficient is a parameter that varies between -1 and
1 and that can be interpreted as it follows:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math">\rho_{i,j}=1</span> implies that <span class="math">x_i</span> linearly increases as
<span class="math">x_j</span> increases;</li>
<li><span class="math">\rho_{i,j}=-1</span> implies that <span class="math">x_i</span> linearly increases as
<span class="math">x_j</span> decreases;</li>
<li><span class="math">\rho_{i,j}=0</span> implies that there is no linear correlation between
the variables.</li>
</ul>
</div></blockquote>
<p>A last important concept, which is often used in the rest of the manual, is
the relative covariance,</p>
<div class="math">
<p><span class="math">rcov(x_i, x_j) = \frac{cov(x_i, x_j)}{x_{i,BE}x_{j,BE}}\,.</span></p>
</div></div>
<div class="section" id="monte-carlo-sampling">
<h2>Monte Carlo Sampling<a class="headerlink" href="#monte-carlo-sampling" title="Permalink to this headline">¶</a></h2>
<p>It is common to refer with the term <em>Monte Carlo sampling</em> to
computational approaches that rely on a repeated random sampling of chosen
parameters to obtain statistical outcomes of selected responses.</p>
<p>Monte Carlo sampling methods are based on drawing sets of samples from the model
input joint probability density function (PDF), as</p>
<div class="math" id="equation-x-samples">
<p><span class="eqno">(1)<a class="headerlink" href="#equation-x-samples" title="Permalink to this equation">¶</a></span><span class="math">\mathbf{X}=\begin{bmatrix}
 x_1^{(1)} &amp; x_1^{(2)} &amp; ... &amp; x_1^{(n)} \\
 x_2^{(1)} &amp; x_2^{(2)} &amp; ... &amp; x_2^{(n)} \\
 \vdots    &amp; \vdots    &amp; \ddots &amp; \vdots \\
 x_m^{(1)} &amp; x_m^{(2)} &amp; ... &amp; x_m^{(n)} \\
\end{bmatrix}\,.</span></p>
</div><p>Given input parameters <span class="math">\mathbf{x}=\left[x_1, x_2, \dots, x_m\right]^T</span>
with a joint PDF <span class="math">p(\mathbf{x})</span> and covariance matrix <span class="math">\mathbf{\Sigma}</span>,
<span class="math">\mathbf{X}</span> is the sample matrix containing on its columns <span class="math">n</span>
independent sets of samples of the type
<span class="math">\mathbf{x}^{(k)}=\left[x_1^{(k)}, x_2^{(k)}, \dots, x_m^{(k)}\right]^T</span> with
<span class="math">k \in 1,\dots,n</span>.
The samples are taken <em>with replacement</em>, that is, each point in the model input
domain is not excluded after being sampled.</p>
<p>One can prove that for any given parameter <span class="math">i</span>, when
<span class="math">n\rightarrow\infty</span>, then</p>
<div class="math" id="equation-x-mean-variance">
<p><span class="eqno">(2)<a class="headerlink" href="#equation-x-mean-variance" title="Permalink to this equation">¶</a></span><span class="math">\overline{x}_i \equiv &amp; \frac{1}{n}\sum_{k=1}^n x_i^{(k)} \rightarrow E\left[x_i\right]\,, \\
s^2_{x_i} \equiv &amp; \frac{1}{n}\sum_{k=1}^n \left( x_i^{(k)} - E\left[x_i\right]\right)^2 \rightarrow V(x_i)\,.</span></p>
</div><p>Analogously, as <span class="math">n\rightarrow\infty</span>, the samples’ distribution and
covariance matrix converge to <span class="math">p(\mathbf{x})</span> and <span class="math">\mathbf{\Sigma}</span>,
respectively.</p>
<p>Now, let us assume that the user is interested in a model of the type
<span class="math">y =f(\mathbf{x})</span>, where <span class="math">y</span> is the model response value, or
simply <em>response</em>.
More specifically, the user wants to quantify the uncertainty of <span class="math">y</span>
produced by <span class="math">\mathbf{x}</span> and assuming that the model <span class="math">f</span> does
not carry any error.</p>
<p>The average - or best estimate - and uncertainty of the response are simply</p>
<div class="math" id="equation-y-sample-mean-variance">
<p><span class="eqno">(3)<a class="headerlink" href="#equation-y-sample-mean-variance" title="Permalink to this equation">¶</a></span><span class="math">y_{BE} = &amp; E\left[f(\mathbf{x})\right] = \int f(\mathbf{x}) p(\mathbf{x}) d\mathbf{x}\,, \\
\Delta y = &amp; E \left[ (f(\mathbf{x}) - y_{BE})^2 \right] ^{1/2}\,.</span></p>
</div><p>The Monte Carlo sampling approach for uncertainty quantification uses
a straightforward approach to reproduce the integrals in equation
<a class="reference internal" href="#equation-y-sample-mean-variance">(3)</a>.
For any given set <span class="math">k</span> of sampled input parameters <span class="math">\mathbf{x}^{(k)}</span>
the model response is quantified as <span class="math">y^{(k)} = f(\mathbf{x}^{(k)})</span>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the rest of the manual we often refer to <span class="math">y^{(k)}</span> as to a <em>perturbed</em> response,
since it reflects the variation of <span class="math">y</span> generated by the perturbations on
<span class="math">\mathbf{x}</span> introduced by the Monte Carlo sampling.</p>
</div>
<p>Then, the <span class="math">n</span> perturbed responses can be grouped into a matrix</p>
<div class="math" id="equation-y-samples-1response">
<p><span class="eqno">(4)<a class="headerlink" href="#equation-y-samples-1response" title="Permalink to this equation">¶</a></span><span class="math">\mathbf{Y}=\begin{bmatrix}
 y^{(1)} &amp; y^{(2)} &amp; ... &amp; y^{(n)} \\
\end{bmatrix}\,,</span></p>
</div><p>Notice that this matrix contains only one row, since so far we only considered models
with a single response value.</p>
<p>Following what was previously done in equation <a class="reference internal" href="#equation-x-mean-variance">(2)</a> for an input
parameter <span class="math">x_i</span>, the best estimate and uncertainty of <span class="math">y</span> can be
approximated with</p>
<div class="math" id="equation-y-mean-variance">
<p><span class="eqno">(5)<a class="headerlink" href="#equation-y-mean-variance" title="Permalink to this equation">¶</a></span><span class="math">\overline{y} \equiv &amp; \frac{1}{n}\sum_{k=1}^n y^{(k)}\,, \\
s^2_{y} \equiv &amp; \frac{1}{n}\sum_{k=1}^n \left( y^{(k)} - E\left[y\right]\right)^2\,,</span></p>
</div><p>which converge to the real solutions for <span class="math">n\rightarrow\infty</span>.</p>
<p>Should the model response be a vector <span class="math">\mathbf{y}=\mathbf{F}(\mathbf{x})</span>,
where <span class="math">\mathbf{y}=\left[ y_1, y_2, \dots, y_l \right]</span>, then the matrix of
perturbed responses becomes</p>
<div class="math" id="equation-y-samples">
<p><span class="eqno">(6)<a class="headerlink" href="#equation-y-samples" title="Permalink to this equation">¶</a></span><span class="math">\mathbf{Y}=\begin{bmatrix}
 y_1^{(1)} &amp; y_1^{(2)} &amp; ... &amp; y_1^{(n)} \\
 y_2^{(1)} &amp; y_2^{(2)} &amp; ... &amp; y_2^{(n)} \\
 \vdots    &amp; \vdots    &amp; \ddots &amp; \vdots \\
 y_l^{(1)} &amp; y_l^{(2)} &amp; ... &amp; y_l^{(n)} \\
\end{bmatrix}\,.</span></p>
</div><p>Any two values <span class="math">y_i</span> and <span class="math">y_j</span> could be two completely different model
responses, or the same response evaluated in two different points of the output
phase-space, e.g. different time, energy or space.
Equations <a class="reference internal" href="#equation-y-mean-variance">(5)</a> still apply to each of the <span class="math">l</span> components
of <span class="math">\mathbf{y}</span>.
In addition, the covariance coefficient of <span class="math">y_i</span> with <span class="math">y_j</span> can
be evaluated as</p>
<div class="math">
<p><span class="math">lim_{n\rightarrow\infty} \frac{1}{n}\sum_{k=1}^n \left( y_i^{(k)} - E\left[y_i\right]\right)\left( y_j^{(k)} - E\left[y_j\right]\right) = cov(y_i,y_j)\,.</span></p>
</div><p>In short, the Monte Carlo sampling for uncertainty propagation simply
consists in running the same model multiple times, every time replacing the input
parameters with a set of samples.
This approach brings numerous advantages compared to other uncertainty propagation
techniques, such as perturbation theory:</p>
<blockquote>
<div><ul class="simple">
<li>its application to any model is straightforward, as it does not interact with the
model itself but only with the model inputs;</li>
<li>there is no need for developing complicated algorithms to calculate adjoint
functions for the model and responses under study;</li>
<li>it does not apply only locally around the input best estimates, but it can cover
the whole input and output phase space;</li>
<li>it can represent any-order effect of the model, as well as interactions between
model inputs.</li>
</ul>
</div></blockquote>
<p>The major drawback of this method lies in the large amount of sets of samples
that must be drawn in order to grant the convergence of the response statistics,
that is, to reduce the statistical error <span class="math">\epsilon</span> on the response best estimate.
The central limit theorem <em>[ref]</em> tells us that this error is proportional to
<span class="math">1/\sqrt{n}</span> and <span class="math">lim_{n\rightarrow\infty} \epsilon = 0</span></p>
<p>The huge improvements of computer performances in the last decades, combined with
model simplifications and dimensionality reductions help reduce the computational
time of the solvers, thus making Monte Carlo sampling a practical option for nuclear
data uncertainty propagation.</p>
</div>
<div class="section" id="sampling-endf-6-nuclear-data-using-sandy">
<h2>Sampling ENDF-6 nuclear data using SANDY<a class="headerlink" href="#sampling-endf-6-nuclear-data-using-sandy" title="Permalink to this headline">¶</a></h2>
<p>As we reported in the previous chapter, the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> files contain best
estimate and covariance data for many of the data important for nuclear
technology.</p>
<p><code class="docutils literal notranslate"><span class="pre">SANDY</span></code>’s sampling is consistent with the work of the nuclear data evaluators,
as it draws random nuclear data samples from the covariance matrices that
are located in the same <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> files.
Generally, a covariance matrix is strictly related to its corresponding
best-estimate data evaluation.
The sampling procedure should make sure to maintain this relation, therefore
it should be avoided sampling from covariance matrices that come from different
evaluations.</p>
<p>However, to proceed with a Monte Carlo sampling approach, one must also know
the probability distribution of the input nuclear data, but there is
currently no defined way on how to store such piece of information
is <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> files.
A thorough study of the evaluated uncertainties and of the evaluation
procedures could give some prior estimation of the distribution.
However, insights on the uncertainties are rarely available in the data files.
Hence, the sensible way to proceed would be for the user to get directly in
touch with the data evaluators, although this step is often cumbersome, if not
impossible.
Most of the times the nuclear data user is left with the only option of
taking assumptions on the input PDF.</p>
<p>A popular assumption in the nuclear community is that nuclear data behave
according to multivariate Normal distributions cite{Zwermann_2011}.
Such an assumption was often inherent to the ENDF-6 format and the
covariance processing cite{Rochman_2011} and it is generally justified by
the following theorems:</p>
<blockquote>
<div><ul class="simple">
<li><cite>Central limit theorem</cite> : the sample mean of a number of samples of
a PDF with a defined mean and a finite variance, approaches a Normal
distribution as the number of samples approaches infinity, regardless of the
underlying choice of the PDF cite{Mood_1974};</li>
<li><cite>Principle of maximum entropy</cite> : if only the mean and variance are
given, the Normal distribution is the one with maximum entropy cite{Cover_2006}.</li>
</ul>
</div></blockquote>
<p>However, sometimes the Normal assumption should be
reconsidered cite{Rochman_2011}.
For examples, the Gaussian distribution would no longer be justified if most
of the uncertainty came from systematic errors
cite{Shlyakhter_1993}.</p>
<p>At its current state, <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> assumes that all the nuclear data are
Normally distributed.
Some development work is currently ongoing to add the capability to
sample from different distributions, such as LogNormal and Uniform.
However, this feature is not yet available in the latest release of
the code.</p>
</div>
<div class="section" id="sampling-methodology-in-details">
<h2>Sampling methodology in details<a class="headerlink" href="#sampling-methodology-in-details" title="Permalink to this headline">¶</a></h2>
<p>This section describes how <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> transfers the best-estimate
(<span class="math">\mathbf{x}_{BE}</span>) and covariance (<span class="math">\mathbf{\Sigma}</span>)
information stored in the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> file to a matrix of
samples <span class="math">\mathbf{X}</span> for which the sample distribution tends to
the multivariate <em>Normal</em> distribution
<span class="math">p(\mathbf{x}) = N(\mathbf{x}_{BE}, \mathbf{\Sigma})</span>
as the number <span class="math">n</span> of set of samples goes to infinity.</p>
<p>First, <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> draws a sample matrix <span class="math">\mathbf{Z}</span> from a standard
distribution <span class="math">N(\mathbf{0},\mathbf{I})</span>, with <span class="math">\mathbf{0}</span>
being a null vector and <span class="math">\mathbf{I}</span> the identity matrix.</p>
<div class="math">
<p><span class="math">\mathbf{Z}=\begin{bmatrix}
 z_1^{(1)} &amp; z_1^{(2)} &amp; ... &amp; z_1^{(n)} \\
 z_2^{(1)} &amp; z_2^{(2)} &amp; ... &amp; z_2^{(n)} \\
 \vdots    &amp; \vdots    &amp; \ddots &amp; \vdots \\
 z_m^{(1)} &amp; z_m^{(2)} &amp; ... &amp; z_m^{(n)} \\
\end{bmatrix}\,.</span></p>
</div><p>The samples in <span class="math">\mathbf{Z}</span> are independent and uncorrelated.</p>
<p>At this point, we define a linear operator <span class="math">\mathbf{L}</span> that, when
applied to uncorrelated standard samples <span class="math">\mathbf{Z}</span>, converts them into
<span class="math">N(\mathbf{0},\mathbf{\Sigma})</span>-distributed samples.</p>
<p>Operator <span class="math">\mathbf{L}</span> does not affect the mean of the distribution, since</p>
<div class="math" id="equation-preserve-mean">
<p><span class="eqno">(7)<a class="headerlink" href="#equation-preserve-mean" title="Permalink to this equation">¶</a></span><span class="math">E \left[ \mathbf{L} \mathbf{Z} \right] = \mathbf{L} E \left[ \mathbf{Z} \right] = \mathbf{0}\,.</span></p>
</div><p>Also, the linearity of the operator preserves the shape of the distribution.</p>
<p>Then, the covariance becomes</p>
<div class="math" id="equation-preserve-cov">
<p><span class="eqno">(8)<a class="headerlink" href="#equation-preserve-cov" title="Permalink to this equation">¶</a></span><span class="math">E \left[ \left(\mathbf{L}\mathbf{Z}\right) \left(\mathbf{L}\mathbf{Z}\right)^T \right] = \mathbf{L} E \left[ \mathbf{Z} \mathbf{Z}^T \right] \mathbf{L}^T
= \mathbf{L} \mathbf{L}^T\,,</span></p>
</div><p>since by definition <span class="math">E \left[ \mathbf{Z} \mathbf{Z}^T \right] = \mathbf{I}</span>.</p>
<p>The problem of sampling Normally distributed variables with a prescribed
covariance matrix reduces to finding <span class="math">\mathbf{L}</span> such that</p>
<div class="math" id="equation-chol-condition">
<p><span class="eqno">(9)<a class="headerlink" href="#equation-chol-condition" title="Permalink to this equation">¶</a></span><span class="math">\mathbf{L} \mathbf{L}^T = \mathbf{\Sigma}\,.</span></p>
</div><p>By default <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> calculates <span class="math">\mathbf{L}</span> by performing the
Cholesky decomposition of <span class="math">\mathbf{\Sigma}</span>.
The Cholesky decomposition applies only to hermitian, positive definite
matrices and returns a lower triangular matrix <span class="math">\mathbf{L}</span> that is
unique, with real and positive diagonal elements,
so that <a class="reference internal" href="#equation-chol-condition">(9)</a> is satisfied.</p>
<p>By definition, the properties of a covariance matrix are:</p>
<blockquote>
<div><ul class="simple">
<li>it is symmetric;</li>
<li>its diagonal elements are real and non-negative;</li>
</ul>
</div></blockquote>
<p>Consequently, only covariance matrices that are
positive-definite satisfy the requirements for a Cholesky factorization.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>It is not rare to find evaluations for which the covariance
matrices have some negative eigenvalues.
Such situations are in contradiction with the definition of a covariance
matrix and must be handled with care.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> cannot investigate into the covariance evaluation process to
identify the sources of this issue.
Therefore, it reconstructs an approximate covariance matrix
<span class="math">\widetilde{\mathbf{\Sigma}}</span> with the negative eigenvalues set to zero.
The assumption is acceptable for small negative eigenvalues that are likely
to sprout from round-off or truncation processes.
For such cases it follows that <span class="math">\widetilde{\mathbf{\Sigma}} \approx \mathbf{\Sigma}</span>.
When the negative eigenvalues are large, <span class="math">\widetilde{\mathbf{\Sigma}}</span>
is not anymore a good approximation of <span class="math">\mathbf{\Sigma}</span>.
Then, the covariance matrix evaluation should be reconsidered as it does not
satisfy the requirements for the Monte Carlo sampling.</p>
</div>
<p>Applying the operator <span class="math">\mathbf{L}</span> to the uncorrelated samples
<span class="math">\mathbf{Z}</span> one obtains a samples matrix <span class="math">\mathbf{L} \mathbf{Z}</span>
that is <span class="math">N(\mathbf{0}, \mathbf{\Sigma})</span>-distributed,
centered in <span class="math">\mathbf{0}</span>, with covariance matrix <span class="math">\mathbf{\Sigma}</span>.
Then, by translating the samples to the desired mean vector <span class="math">\mathbf{x}_{BE}</span>
— we can do it without changing neither the covariance, nor the shape of the
distribution — one obtains <span class="math">N(\mathbf{x}_{BE}, \mathbf{\Sigma})</span>-distributed
samples</p>
<div class="math">
<p><span class="math">\mathbf{X} = \mathbf{x}_{BE} + \mathbf{L} \mathbf{Z}\,.</span></p>
</div><p>These results are valid when <span class="math">\mathbf{\Sigma}</span> contains absolute
covariances.
However, most of the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> sections provide relative covariances, which
implies that the samples <span class="math">\mathbf{L} \mathbf{Z}</span> are in relative units.
Then, samples <span class="math">\mathbf{X}</span> can still be obtained as</p>
<div class="math">
<p><span class="math">\mathbf{X} &amp;= \mathbf{x}_{BE} + \mathbf{x}_{BE} \circ \mathbf{L} \mathbf{Z} \\
           &amp;= \mathbf{x}_{BE} \circ \left(\mathbf{1} + \mathbf{L} \mathbf{Z} \right)\\
           &amp;= \mathbf{x}_{BE} \circ \mathbf{P}\,,</span></p>
</div><p>where <span class="math">\mathbf{1}</span> is a unitary vector and <span class="math">\circ</span> is the element-wise
product.
We generally refer to <span class="math">\mathbf{P} = \mathbf{1} + \mathbf{L} \mathbf{Z}</span> as
to the perturbation matrix of the system, since any <span class="math">P_{i,j}</span> element
introduces a perturbation to the corresponding best-estimate <span class="math">x_{i,BE}</span>
via a simple multiplication.</p>
<div class="math">
<p><span class="math">X_{i,j} = x_{i,BE} P_{i,j}\,.</span></p>
</div></div>
<div class="section" id="cross-sections-mf33">
<h2>Cross sections (MF33)<a class="headerlink" href="#cross-sections-mf33" title="Permalink to this headline">¶</a></h2>
<div class="section" id="best-estimates">
<h3>Best-estimates<a class="headerlink" href="#best-estimates" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> files contain evaluated, best-estimates reaction cross sections
<span class="math">\sigma(E)</span> in section <code class="docutils literal notranslate"><span class="pre">MF3</span></code> as a function of the incident neutron
energy <span class="math">E</span>.
In addition to tabulated energy-cross section pairs
<span class="math">\left[ E_i,\sigma(E_i) \right]</span>, interpolation schemes are
given that specify the energy variation of the data for incident energies
between two adjacent energy points.
Using that information, linearized cross sections can be reconstructed over an
unionized energy grid.
The linearized cross section format is called pointwise-<code class="docutils literal notranslate"><span class="pre">ENDF</span></code> (<code class="docutils literal notranslate"><span class="pre">PENDF</span></code>)
and it is particularly suitable for codes working with continuous energies
since a cross section value can be extracted at any energy
point via a simple linear interpolation.</p>
<dl class="docutils">
<dt>The <code class="docutils literal notranslate"><span class="pre">MT</span></code> numbers that define the most common reaction cross sections are:</dt>
<dd><ul class="first last simple">
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT1</span></code>:</th><td class="field-body">: total cross section;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT2</span></code>:</th><td class="field-body">: elastic cross section;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT4</span></code>:</th><td class="field-body">: inelastic cross section;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT18</span></code>:</th><td class="field-body">: fission cross section;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT51-91</span></code>:</th><td class="field-body">: discrete and continuous levels of the inelastic cross section;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">MT102</span></code>:</th><td class="field-body">: radiative capture cross section.</td>
</tr>
</tbody>
</table>
</li>
</ul>
</dd>
</dl>
<p>Other <code class="docutils literal notranslate"><span class="pre">MT</span></code> numbers are reserved for more exotic reactions, for which the
description is reported in the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> manual.</p>
<p>The information stored in the various <code class="docutils literal notranslate"><span class="pre">MT</span></code> sections is often <em>redundant</em>, as
some cross sections can be derived from others via summation rules.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A cross section is defined as <em>redundant</em> when it can be completely calculated
from the combination of other cross sections, according to the conservation
laws.</p>
</div>
<p>Example 1: the total cross section can be reconstructed as the sum of all the
partial (non-redundant) cross sections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MF3</span><span class="o">/</span><span class="n">MT1</span> <span class="o">=</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT2</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT4</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT18</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT102</span> <span class="o">+</span> <span class="o">...</span>
</pre></div>
</div>
<p>Example 2: the inelastic cross section can be reconstructed as the sum of
all the discrete and continuous inelastic levels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MF3</span><span class="o">/</span><span class="n">MT4</span> <span class="o">=</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT51</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT52</span> <span class="o">+</span> <span class="o">...</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT90</span> <span class="o">+</span> <span class="n">MF3</span><span class="o">/</span><span class="n">MT91</span>
</pre></div>
</div>
</div>
<div class="section" id="covariances">
<h3>Covariances<a class="headerlink" href="#covariances" title="Permalink to this headline">¶</a></h3>
<p>Section <code class="docutils literal notranslate"><span class="pre">MF33</span></code> of the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format files contains the covariances
of the neutron cross sections appearing in section <code class="docutils literal notranslate"><span class="pre">MF3</span></code>.</p>
<p>Covariances are given for:</p>
<blockquote>
<div><ul class="simple">
<li>the cross section of a reaction <span class="math">r</span> evaluated at different energies <span class="math">E_i</span> and <span class="math">E_j</span>:
<span class="math">cov(\sigma_r(E_i),\sigma_r(E_j))</span>;</li>
<li>the cross sections of different reactions <span class="math">r</span> and <span class="math">p</span> evaluated at different energies <span class="math">E_i</span> and <span class="math">E_j</span>:
<span class="math">cov(\sigma_r(E_i),\sigma_p(E_j))</span>;</li>
<li>the cross sections of different materials.</li>
</ul>
</div></blockquote>
<p>The latter option is not yet implemented in <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>.
However, it has to be said that only few are the files that
provide such covariances in the current general-purpose nuclear data
libraries.</p>
<p>The covariance information is expressed either explicitly in the
so-called <em>NI-Type</em> sections, or as a combination of explicit
covariances in the <em>NC-Type</em> sections.</p>
<div class="section" id="ni-type-section">
<h4>NI-Type section<a class="headerlink" href="#ni-type-section" title="Permalink to this headline">¶</a></h4>
<p>The <em>NI-Type</em> sections provide group-averaged covariances that can
be arranged into a multigroup covariance matrix <span class="math">\mathbf{\Sigma}</span>.</p>
<div class="figure" id="id9">
<a class="reference internal image-reference" href="figures/corr_bi209_ngamma.pdf"><img alt="figures/corr_bi209_ngamma.pdf" src="figures/corr_bi209_ngamma.pdf" /></a>
<p class="caption"><span class="caption-text">Multigroup correlation matrix.</span></p>
</div>
<p>Although their multigroup structures, covariance matrices can also apply to
continuous energy data.
Let us take a cross section <span class="math">\sigma(E)</span> that is a continuous
function of the incident-neutron energy <span class="math">E</span>.
<span class="math">\mathbf{\Sigma}</span> is the multigroup covariance matrix of
<span class="math">\sigma(E)</span>, with each term <span class="math">\Sigma_{g,g'}</span> being a constant
value defined over the energy groups <span class="math">g</span> and <span class="math">g'</span>.
Then, taken two evaluations of the cross section at energies <span class="math">E_i</span> and
<span class="math">E_j</span>,</p>
<div class="math">
<p><span class="math">cov(\sigma(E_i),\sigma(E_j))=\Sigma_{g,g'} \, \iff \, E_i \in g,\, E_j \in g'\,.</span></p>
</div><p>Each <em>NI-Type</em> section consists of tabulated functions and a
parameter <code class="docutils literal notranslate"><span class="pre">LB</span></code>.
The parameter <code class="docutils literal notranslate"><span class="pre">LB</span></code> defines how the tabulated functions must be used
to directly reconstruct either the relative covariance matrix
(<code class="docutils literal notranslate"><span class="pre">LB=1,2,3,4,5,6</span></code>) or the absolute covariance matrix (<code class="docutils literal notranslate"><span class="pre">LB=0,8,9</span></code>).</p>
<blockquote>
<div><ul class="simple">
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=0</span></code>:</th><td class="field-body">: only the absolute variances are given for one group structure assuming all energy groups to be uncorrelated;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=1</span></code>:</th><td class="field-body">: only the relative variances are given for one group structure assuming all energy groups to be uncorrelated;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=2</span></code>:</th><td class="field-body">: relative components are given for one group structure assuming all energy groups to be fully correlated;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=3</span></code>:</th><td class="field-body">: relative components are given for two group structures assuming all energy groups to be fully correlated;</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=4</span></code>:</th><td class="field-body">: relative components are given for one group structure. A second group structure is provided to define ???</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=5</span></code>:</th><td class="field-body">: all the components of the covariance matrix are explicitly given. The matrix is square and defined for a single group structure. If the matrix is symmetric, only the upper triangular part is provided.</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=6</span></code>:</th><td class="field-body">: all the components of the covariance matrix are explicitly given. The matrix is not square square and two group structures are provided, one per matrix dimension. This option is often used to provide a covariance matrix for cross sections of two different reaction types or materials, which might be defined on different energy grids.</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">LB=8,9</span></code>:</th><td class="field-body">: absolute variance components are given. These formats are dedicated for multigroup processing codes, since the actual cross section variance depends on the user’s choice of the energy intervals along which the cross sections are averaged. In continuous energy, the cross section are pointwise and the energy intervals tend to zero.</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<p>A covariance matrix can be given from a single <em>NI-Type</em> section or from a
combination of several.
For extra information on the covariance reconstruction rules one
could refer to the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> or to the <code class="docutils literal notranslate"><span class="pre">NJOY</span></code> manual.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">At the current stage, <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> does not process <em>NI-Type</em> sections
with <code class="docutils literal notranslate"><span class="pre">LB=0,8,9</span></code>, that is, where the information to reconstruct
absolute covariance matrices is given.
Hence, for the rest of the chapter we refer only to relative
covariance matrices.</p>
</div>
</div>
<div class="section" id="nc-type-section">
<h4>NC-Type section<a class="headerlink" href="#nc-type-section" title="Permalink to this headline">¶</a></h4>
<p>The <em>NC-Type</em> sections do not contain information to reconstruct the
covariance matrices, but they describe how <em>derived</em> cross
sections may be obtained in given energy ranges in terms of:</p>
<blockquote>
<div><ul class="simple">
<li>the summation of other cross sections for which the covariances
are explicitly given;</li>
<li>the ratio to other cross sections fro which the covariances
are explicitly given.</li>
</ul>
</div></blockquote>
<p>Correlations between cross section arise implicitly from the
“derivation relations” described in the <em>NC-Type</em> cross sections.</p>
<p><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> does not process any <em>NC-Type</em> section, but it rather applies
pre-defined conservation laws to reconstruct the so-called
<em>redundant</em> cross sections.</p>
<p>The process of <em>redundant</em> cross section reconstruction is implemented
automatically in <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> and applies to each set of unperturbed and
perturbed cross sections, independently.</p>
</div>
</div>
<div class="section" id="lumped-reaction-covariances">
<h3>Lumped reaction covariances<a class="headerlink" href="#lumped-reaction-covariances" title="Permalink to this headline">¶</a></h3>
<p>Lumped reaction covariances are not covered by <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>.</p>
</div>
<div class="section" id="id1">
<h3>Sampling<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> draws <span class="math">N</span> samples from the <span class="math">M</span>-group relative
covariance matrix using a multivariate normal distribution centered
in zero:</p>
<div class="math">
<p><span class="math">N(1, RCOV) \rightarrow
p =
\begin{bmatrix}
p_1^{(1)}  &amp; p_1^{(2)} &amp; p_1^{(3)} &amp; \dots  &amp; p_1^{(N)} \\
p_2^{(1)}  &amp; p_2^{(2)} &amp; p_2^{(3)} &amp; \dots  &amp; p_2^{(N)} \\
\vdots     &amp; \vdots    &amp; \vdots    &amp; \ddots &amp; \vdots \\
p_M^{(1)}  &amp; p_M^{(2)} &amp; p_M^{(3)} &amp; \dots  &amp; p_M^{(N)}
\end{bmatrix}</span></p>
</div><p>Such samples are often referred as perturbation factors as they directly
apply a perturbation to the cross section with a simple multiplication.</p>
<p>A perturbation factor <span class="math">p_i^{(k)}</span> refers to a given energy group
of the covariance matrix <span class="math">E_i \leq E \leq E_{i+1}</span>.
Hence, it perturbs only the tabulated cross section points
<span class="math">x(E_j)^{(k)}</span> for any energy <span class="math">E_j</span> that belongs to the
covariance energy-group</p>
<div class="math">
<p><span class="math">x(E_j)^{(k)} = x(E_j) \sum_i p_i^{(k)} \delta_{i,j}</span></p>
</div><p>where:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math">x(E_j)</span> is the tabulated cross section at energy <span class="math">E_j</span>;</li>
<li><span class="math">x(E_j)^{(k)}</span> is the perturbed tabulated cross section at energy <span class="math">E_j</span>;</li>
<li><span class="math">p_i^{(k)}</span> is the perturbation coefficient for the energy group <span class="math">E_i \leq E \leq E_{i+1}</span>;</li>
<li><span class="math">\delta_{i,j}=1</span> when <span class="math">E_i \leq E_j \leq E_{i+1}</span>, otherwise <span class="math">\delta_{i,j}=0</span>.</li>
</ul>
</div></blockquote>
<p>As a consequence, any two tabulated cross section points <span class="math">x(E_i)</span> and
<span class="math">x(E_j)</span>, for which <span class="math">E_i</span> and <span class="math">E_j</span> belong to the same
covariance group, are assumed 100% correlated.</p>
<p>Often, the summation rules given in a <em>NC-Type</em> section are identical
to the pre-defined laws used by <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>.
However, sometimes they are defined as the difference between
other cross sections.
When this happens, there are chances that negative cross section values arise.
It is the case of <span class="math">^{16}O</span>, for which the inelastic cross section
<span class="math">\sigma_{inel}</span> must be derived by subtracting the elastic
cross section <span class="math">\sigma_{el}</span> and all the other partial cross
sections (<span class="math">\sigma_r</span>) from the total cross sections <span class="math">\sigma_{tot}</span>,
according to the <em>NC-Type</em> section in the
<code class="docutils literal notranslate"><span class="pre">ENDF/B-VII.1</span></code> file.</p>
<div class="math" id="equation-sumo16">
<p><span class="eqno">(10)<a class="headerlink" href="#equation-sumo16" title="Permalink to this equation">¶</a></span><span class="math">\sigma_{inel} = \sigma_{tot} - \sigma_{el} - \sum_r \sigma_r</span></p>
</div><p>At thermal energy (0.0253 eV), the total and elastic cross sections are
respectively</p>
<div class="math">
<p><span class="math">\sigma_{tot} = 3.9620963\,\,b \,\,\,\,\,\,\,\,\,\,\,\,\,\,
\sigma_{el} = 3.961907\,\,b.</span></p>
</div><p>The two values differ by only 0.005%, since the elastic scattering is by far
the dominant interaction at that energy.
According to the <code class="docutils literal notranslate"><span class="pre">MF33</span></code> section of <code class="docutils literal notranslate"><span class="pre">ENDF/B-VII.1</span></code>, the two reactions
are not correlated (no <em>NC-Type</em> section, nor an explicit covariance
between the two reactions is given) and have both an uncertainty of 2%.</p>
<p>By drawing independent samples for the two reactions, there is a high probability
that the perturbed elastic cross section be larger than the total cross section.
Then, according to the equation <a class="reference internal" href="#equation-sumo16">(10)</a>, the perturbed inelastic cross
section <span class="math">\sigma_{inel}</span> would be negative.</p>
<p>It must be said that the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> rules advise against evaluating
<em>NC-Type</em> sections for a given parameter as the difference of two other
parameters with a similar larger order of magnitude.
However, since at the current stage there is no algorithm implemented in
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code> to distinguish and exclude <em>NC-Type</em> sections such as
the one evaluated for the <span class="math">^{16}O</span> inelastic cross section
by <code class="docutils literal notranslate"><span class="pre">ENDF/B-VII.1</span></code>, the code simply skips all the <em>NC-Type</em> sections.</p>
<p>Sometimes a covariance matrix is given explicitly for a <em>redundant</em>
cross section, but none is provided for its components, neither
explicitly nor using a <em>NC-Type</em> section.</p>
<p>By definition, a redundant cross section <span class="math">\sigma_R</span> can be obtained
from the sum of its components <span class="math">\sigma_c</span>, as</p>
<div class="math" id="equation-sum">
<p><span class="eqno">(11)<a class="headerlink" href="#equation-sum" title="Permalink to this equation">¶</a></span><span class="math">\sigma_R = \sum_c \sigma_c\,,</span></p>
</div><p>which implies correlations between the reactions.</p>
<p>By sampling the redundant cross sections and leaving its components
unperturbed, the correlations between channels would be lost, as well
as the physics expressed in equation <a class="reference internal" href="#equation-sum">(11)</a>
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code> reintroduces the correlations into the system by
assigning the same perturbation coefficients used for
<span class="math">\sigma_R</span> to all the <span class="math">\sigma_c</span> cross sections.
By doing so, every set of sample comply with the summation rule
in equation <a class="reference internal" href="#equation-sum">(11)</a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> apportions the samples of a <em>redundant</em> cross section to
its components only when of its components has got its own samples.</p>
</div>
<div class="section" id="sampling-options">
<h4>Sampling options<a class="headerlink" href="#sampling-options" title="Permalink to this headline">¶</a></h4>
<p>Use command MF : 33</p>
<p>cross sections are linearized with tolerance 0.1% using RECONR
option
linearization is important to have enough cross section points to cover the whole cross section energy domain, and not lose information from the multigroup
covariance matrix.</p>
<p>Whole cross sections are perturbed, unless MT option is defined</p>
<p>All correlations explicitly given, except NC-Type are included, unless option
is used</p>
<p>If the user whishes to erase all cross section correlations, including the
correlations find in each <em>NI-Type</em> section for a single reaction…
In the testing of <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>, we found this option particularly useful to bypass
the problem of working with non positive-definite matrices (a covariance
matrix without off-diagonal terms and with positive variances is always
positive-definite).
Another important application for this option could be in linear regression
analysis, to prevent problems related to multicollinearity.</p>
</div>
</div>
</div>
<div class="section" id="fission-neutron-multiplicities-mf31">
<h2>Fission Neutron multiplicities (MF31)<a class="headerlink" href="#fission-neutron-multiplicities-mf31" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="resonance-parameters-mf32">
<h2>Resonance parameters (MF32)<a class="headerlink" href="#resonance-parameters-mf32" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Best-estimates<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Resonance parameters are allowed by the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format in section <code class="docutils literal notranslate"><span class="pre">MF2</span></code>
Only one <code class="docutils literal notranslate"><span class="pre">MT</span></code> section — <code class="docutils literal notranslate"><span class="pre">MT151</span></code> — is given, which contains all the
resonance data.
The resonances are divided into several ranges according to the
incident neutron energy.
A given range corresponds either to the resolved resonance region (RRR) —
where resonance parameters for individual resonances are given — or to
the unresolved resonance region (URR) — where the experimental resolution
is not adequate to separate two non-oberlapping resonances.
No capability for the processing of the URR is currently implemented in
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code>, therefore this URR will not be described in this manual.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format allows storing resonance parameters for a maximum
of 10 isotopes in the same section <code class="docutils literal notranslate"><span class="pre">MF2</span></code>, each isotope defined by a
given abundance.
Notice that <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> can only work with <code class="docutils literal notranslate"><span class="pre">MF2</span></code> sections were
resonance parameters are given only for one isotope.</p>
</div>
<p>Historically, six were the accepted representations for the resonance
parameters in the RRR:</p>
<blockquote>
<div><ul class="simple">
<li>single or multi-level Breit-Wigner (BW);</li>
<li>Reich-Moore (RM);</li>
<li>Adler-Adler;</li>
<li>General R-matrix;</li>
<li>Hybrid R-function;</li>
<li>R-matrix limited format.</li>
</ul>
</div></blockquote>
<p>However, the General R-matrix and the Hybrid R-function formats are no longer
available in <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code>.</p>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> can only sample resolved resonance parameters given in
BW or RM formalism, which cover the majority of the current evaluations.
However, because of the increasing popularity of the R-matrix limited
formalism, it is foreseen to add extra capabilities to the code to manage
resonance parameters expressed in such a representation.</p>
<p>Resolved resonances are divided in further subsections according to
the orbital angular momentum (or <em>l</em>-value).
For each subsection, the resolved resonances are listed in consecutive
lines where the following parameters are explicitly given.</p>
<blockquote>
<div><ul>
<li><p class="first">single- or multi-level Breit-Wigner formalism:</p>
<ul class="simple">
<li><span class="math">E_r</span> : the resonance energy in the laboratory system;</li>
<li><span class="math">J</span> : the spin of the resonance;</li>
<li><span class="math">\Gamma</span> : total resonance width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_n</span> : neutron width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_g</span> : radiation width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_f</span> : fission width evaluated at the resonance energy <span class="math">E_r</span></li>
</ul>
<p>According to the conservation laws, the total width is equal to the sum of the
partial widths</p>
<div class="math" id="equation-sum-widths">
<p><span class="eqno">(12)<a class="headerlink" href="#equation-sum-widths" title="Permalink to this equation">¶</a></span><span class="math">\Gamma = \Gamma_n + \Gamma_g + \Gamma_f + \Gamma_x\,,</span></p>
</div><p>where <span class="math">\Gamma_x</span> is the competitive width (normally inelastic
scattering to the first excited state), which is not explicitly given.
In case a competitive width exist, it must be recovered from equation
<a class="reference internal" href="#equation-sum-widths">(12)</a>.</p>
</li>
<li><p class="first">Reich-Moore formalism:</p>
<ul class="simple">
<li><span class="math">E_r</span> : the resonance energy in the laboratory system;</li>
<li><span class="math">J</span> : the spin of the resonance;</li>
<li><span class="math">\Gamma</span> : total resonance width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_n</span> : neutron width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_{f_A}</span> : first partial fission width evaluated at the resonance energy <span class="math">E_r</span></li>
<li><span class="math">\Gamma_{f_B}</span> : second partial fission width evaluated at the resonance energy <span class="math">E_r</span></li>
</ul>
<p>For the Reich-Moore formalisms, competitive reactions are not used.</p>
</li>
</ul>
</div></blockquote>
<p>Both formalism provide a scattering radius <span class="math">a_p</span> that can be constant
or energy-dependent.
Also, in the Reich-Moore formalism, different radii are accepted for the
several <em>l</em>-values.</p>
<p>The best-estimate parameters given in <code class="docutils literal notranslate"><span class="pre">MF2</span></code> is also repeated in
<code class="docutils literal notranslate"><span class="pre">MF32</span></code> for most of the resolved resonance.
As a general rule, the best-estimate parameters of a given resonance in
section <code class="docutils literal notranslate"><span class="pre">MF2</span></code> are also reported in section <code class="docutils literal notranslate"><span class="pre">MF32</span></code> as long as they have
a non-zero variance.
If this is not the case, the resonance is omitted from <code class="docutils literal notranslate"><span class="pre">MF32</span></code>, thus
preventing from storing zero-terms in the covariance section.</p>
</div>
<div class="section" id="id3">
<h3>Covariances<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Section <code class="docutils literal notranslate"><span class="pre">MF32</span></code> of the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format contains covariances for most of
(or all) the resonance parameters given in section <code class="docutils literal notranslate"><span class="pre">MF2</span></code>.
Again, the only <code class="docutils literal notranslate"><span class="pre">MT</span></code> section available is <code class="docutils literal notranslate"><span class="pre">MT151</span></code>.
The covariances contain either</p>
<blockquote>
<div><ul class="simple">
<li><em>long-range</em> components, which follow the energy dependence of some
parameters, thus spanning over several resonances;</li>
<li><em>short-range</em> components, which refer to parameters the neighborhood of
individual resonances.</li>
</ul>
</div></blockquote>
<p>In the process of testing <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>, we could not find any long-range covariance
section in the most common general purpose nuclear data files in <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format.
.. No long-range in JEFF-3.2</p>
<blockquote>
<div>No long-range in ENDF/B-VII.1</div></blockquote>
<p>As a consequence, no development effort was made to include in <code class="docutils literal notranslate"><span class="pre">SANDY</span></code> some
capabilities for the processing of the long-range covariances.</p>
<p>FOOTNOTE
Many data allowed by the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format are only rarely used by the
evaluators.
If</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">SANDY</span></code> raises an error message when long-range covariances are found.</p>
</div>
<p>In general, the format for the short-range covariances depends on the
resonance formalism, however those used for BW and RM can be considered
equivalent.
A compatibility flag <code class="docutils literal notranslate"><span class="pre">lcomp</span></code> defines the format in which the
covariances are given:</p>
<blockquote>
<div><ul>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">lcomp=0</span></code>:</th><td class="field-body">: covariances can only be given between parameters for</td>
</tr>
</tbody>
</table>
<p>the same resonance. This format is applicable only for the BW formalisms.
Also, no long-range covariances can be defined.</p>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">lcomp=1</span></code>:</th><td class="field-body">: all the resonances for which covariances are to be</td>
</tr>
</tbody>
</table>
<p>included are divided into blocks — or short-range sections.
Covariances between parameters can only be included for resonances
in the same block.
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code> returns an error if more than one block is given.
Long-range covariances can be defined, but they are not covered
by <code class="docutils literal notranslate"><span class="pre">SANDY</span></code>.</p>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal notranslate"><span class="pre">lcomp=2</span></code>:</th><td class="field-body">: standard deviations are given together with the</td>
</tr>
</tbody>
</table>
<p>best estimates.
Correlations coefficients (in compact form) follow.
This format is suitable for sparse matrices, which would be impractical
to store in <code class="docutils literal notranslate"><span class="pre">lcomp=1</span></code> format.</p>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Contrary to most of the other covariance sections, absolute covariances
are used in <code class="docutils literal notranslate"><span class="pre">MF32</span></code>.</p>
</div>
<p>In contrast with reaction cross section covariances in section <code class="docutils literal notranslate"><span class="pre">MF33</span></code>,
the covariances in section <code class="docutils literal notranslate"><span class="pre">MF32</span></code> have a bijective relation with their
corresponding resonance parameters and do not introduce any multigroup
assumption.</p>
<p>scattering radius</p>
</div>
<div class="section" id="id4">
<h3>Sampling<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>SANDY draws perturbation coefficients from the data and covariances
in section <code class="docutils literal notranslate"><span class="pre">MF32</span></code>.
The perturbation coefficients are applied to the best-estimate in <code class="docutils literal notranslate"><span class="pre">MF32</span></code></p>
<p>Recall that MF2 and MF32 do not have the same number of resonances.
To produce the perturbed output files, the parameter in <code class="docutils literal notranslate"><span class="pre">MF2</span></code> is replaced
by samples when its analogous is found <code class="docutils literal notranslate"><span class="pre">MF32</span></code>
Equivalence determined by equal spin and energy (tolerance 1e-5%)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In contrast with reaction other energy-dependent data, the covariances in
section <code class="docutils literal notranslate"><span class="pre">MF32</span></code> have a bijective relation with their corresponding resonance
parameters.</p>
</div>
<p>Sometimes, the best-estimate resonance parameters differ between <code class="docutils literal notranslate"><span class="pre">MF2</span></code>
and <code class="docutils literal notranslate"><span class="pre">MF32</span></code>.
It is evident that such a situation is a mistake in the evaluation.
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code> detects such discrepancies and raises a warning message.
However, from the mere reading of the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> data the code cannot
make a sensible choice based on physics.
Hence, during the sampling process, the perturbation factors are
applied to the <code class="docutils literal notranslate"><span class="pre">MF32</span></code> best-estimates, to keep consistency
with the covariances given in the same section.</p>
<p><code class="docutils literal notranslate"><span class="pre">SANDY</span></code>’s sampling routine accounts for any correlation between different
channels and energy levels.
On top of that, when given explicitly (i.e. Breit-Wigner format),
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code> reconstruct the total width samples
according to the physical constraint</p>
</div>
<div class="section" id="output-files">
<h3>Output files<a class="headerlink" href="#output-files" title="Permalink to this headline">¶</a></h3>
<p>HENDF</p>
</div>
<div class="section" id="id5">
<h3>Sampling options<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>MF</p>
<p>MT</p>
<p>stdmax</p>
<p>no_correlations</p>
</div>
</div>
<div class="section" id="angular-distributions-mf34">
<h2>Angular distributions (MF34)<a class="headerlink" href="#angular-distributions-mf34" title="Permalink to this headline">¶</a></h2>
<p>In a neutron-nucleus reaction, particles can be emitted to specific
directions according to the physics of the interaction.
The probability that a particle is emitted into the interval <span class="math">d\mu</span>
about an angle whose cosine is <span class="math">\mu</span> following an interaction between
a nucleus and a neutron with incident energy <span class="math">E</span> can be expressed by
normalized distributions, such as:</p>
<div class="math">
<p><span class="math">\int_{-1}^{1} f(\mu, E) d\mu = 1</span></p>
</div><p>where <span class="math">f(\mu, E)</span> is the probability density function by unit angle and
incident energy.</p>
<p>Since the angular distribution of secondary particles is generally assumed to
have azimuthal symmetry, the dependence on the outgoing angle and
incident-neutron energy can be decoupled by representing the distribution as
a Legendre polynomial series:</p>
<div class="math">
<p><span class="math">f(\mu, E) = \sum_{l=0}^{NL}\frac{2l+1}{2}a_l{E}P_l{\mu}</span></p>
</div><dl class="docutils">
<dt>where:</dt>
<dd><ul class="first last simple">
<li><span class="math">l</span> is the order of the Legendre polynomial;</li>
<li><span class="math">NL</span> is the highest order of the Legendre polynomial that is given at each energy;</li>
<li><span class="math">a_l(E)</span> is the <em>l</em>-th energy-dependent Legendre polynomial coefficient;</li>
<li><span class="math">P_l(\mu)</span> is the <em>l</em>-th Legendre polynomial.</li>
</ul>
</dd>
</dl>
<p>The angular distributions for secondary particles are provided in the <cite>ENDF-6</cite>
format file in section <cite>MF4</cite>.
Such data can be stored in a file section with one of the following four
formats:</p>
<blockquote>
<div><ul class="simple">
<li>purely isotropic angular distributions;</li>
<li>Legendre polynomial coefficients;</li>
<li>tabulated probability distributions;</li>
<li>angular distribution over two energy ranges.</li>
</ul>
</div></blockquote>
<p>The covariance matrices for the angular distributions of secondary particles
are provided in the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format file in section <code class="docutils literal notranslate"><span class="pre">MF34</span></code>.
Because of the simplicity of representing the covariances of Legendre
coefficients rather than normalized probability components, only the former is
considered in the <code class="docutils literal notranslate"><span class="pre">ENDF-6</span></code> format, even for cases where <code class="docutils literal notranslate"><span class="pre">MF4</span></code> has tabulated
probability distributions.</p>
<div class="section" id="sampling-correlations">
<h3>Sampling correlations<a class="headerlink" href="#sampling-correlations" title="Permalink to this headline">¶</a></h3>
<p>Covariances for the Legendre polynomial coefficients are provided as average
values over a multi-group structure of the incident-neutron energy.
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code>’s sampling routine can process any correlation between energy
groups and polynomial coefficients.
However, it does not handle correlations between different reactions or
materials.</p>
</div>
<div class="section" id="adding-extra-points-to-the-incident-neutron-energy-grid">
<h3>Adding extra points to the incident-neutron energy grid<a class="headerlink" href="#adding-extra-points-to-the-incident-neutron-energy-grid" title="Permalink to this headline">¶</a></h3>
<p>Given the multi-group energy structure of the covariance matrices
angular distributions are provided according
to multigroup structures along the incident-neutron energy
<code class="docutils literal notranslate"><span class="pre">SANDY</span></code>’s sampling routine includes correlations between of Legendre
polynomial coefficients at different correlations between Legendre
polynomial coefficients aaccounts for any correlation between different
channels and energy levels.</p>
</div>
</div>
<div class="section" id="energy-distributions-mf35">
<h2>Energy distributions (MF35)<a class="headerlink" href="#energy-distributions-mf35" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id6">
<h3>Best estimates<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Continuous function dependent on the incident neutron and outgoing particle
energy.
Normalized (not always to 1)
Tabulated values.</p>
</div>
<div class="section" id="id7">
<h3>Covariances<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Only for tabulated values
Few incident-energies because of strong correlations</p>
<p>No correlation between between separate covariances, which are sampled independently.</p>
<p>Add points along the energy grid to capture all the covariance terms</p>
<p>The ENDF format manual notes these matrices are probability distributions
that must remain normalized to unity and therefore the elements in these sym-
metric matrices are constrained such that the sum of the elements in any row
(or column) must be zero. This is sometimes referred to as the <cite>zero sum</cite> rule.</p>
<p>renormalize to comply with the <cite>zero sum</cite> rule.
Renormalize to 1, although original might not be by 1-2%.
The renormalization could change a lot the effect of the covariance matrix if the original covariance matrix did not comply with the zero-sum rule.</p>
<div class="section" id="id8">
<h4>Sampling options<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>MF : 35</p>
<p>One could chose the MT, bu we only found covariance for MT18
MT : 18</p>
</div>
</div>
</div>
<div class="section" id="decay-data-and-fission-yields-mf8">
<h2>Decay data and fission yields (MF8)<a class="headerlink" href="#decay-data-and-fission-yields-mf8" title="Permalink to this headline">¶</a></h2>
<p>Best estimates stored in MF8
Covariance are not allowed by the format, only uncertainty.</p>
<p>Covariances for branching ratios and fission yield in development.</p>
<p>This part is not yet included in the current release.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">SANDY</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="endf6.html">The ENDF-6 format</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainty_propagation.html">Uncertainty propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Exercises</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Luca Fiorito.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/sampling.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>